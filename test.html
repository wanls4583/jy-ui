<!--
 * @Author: lisong
 * @Date: 2021-04-20 16:01:12
 * @Description: 
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="css/song-ui.css">
    <style>
        body {
            padding: 20px;
        }

        .song-field {
            margin-bottom: 50px;
        }

        .color-cont {
            display: inline-block;
            width: 100px;
            height: 50px;
            line-height: 50px;
            color: #fff;
            text-align: center;
        }

        .col-cont {
            padding: 10px;
            background-color: #5FB878;
            border: 1px solid #fff;
            font-size: 20px;
            color: #fff;
            text-align: center;
        }
    </style>
</head>

<body>
    <fieldset class="song-field">
        <legend>栅格系统</legend>
        <div class="song-field-box">
            <div class="song-row">
                <div class="song-col-1 song-border-success">
                    <div class="col-cont">1</div>
                </div>
                <div class="song-col-11 song-border-success">
                    <div class="col-cont">11</div>
                </div>
            </div>
            <div class="song-row">
                <div class="song-col-2 song-border-success">
                    <div class="col-cont">2</div>
                </div>
                <div class="song-col-10 song-border-success">
                    <div class="col-cont">10</div>
                </div>
            </div>
            <div class="song-row">
                <div class="song-col-3 song-border-success">
                    <div class="col-cont">3</div>
                </div>
                <div class="song-col-9 song-border-success">
                    <div class="col-cont">9</div>
                </div>
            </div>
            <div class="song-row">
                <div class="song-col-4 song-border-success">
                    <div class="col-cont">4</div>
                </div>
                <div class="song-col-8 song-border-success">
                    <div class="col-cont">8</div>
                </div>
            </div>
            <div class="song-row">
                <div class="song-col-5 song-border-success">
                    <div class="col-cont">5</div>
                </div>
                <div class="song-col-7 song-border-success">
                    <div class="col-cont">7</div>
                </div>
            </div>
            <div class="song-row">
                <div class="song-col-6 song-border-success">
                    <div class="col-cont">6</div>
                </div>
                <div class="song-col-6 song-border-success">
                    <div class="col-cont">6</div>
                </div>
            </div>
        </div>
    </fieldset>
    <fieldset class="song-field">
        <legend>颜色</legend>
        <div class="song-field-box">
            <span class="color-cont song-bgcolor-success">#009688</span>
            <span class="color-cont song-bgcolor-link">#5FB878</span>
            <span class="color-cont song-bgcolor-blue">#1E9FFF</span>
            <span class="color-cont song-bgcolor-warn">#FFB800</span>
            <span class="color-cont song-bgcolor-danger">#FF5722</span>
        </div>
    </fieldset>
    <fieldset class="song-field">
        <legend>按钮</legend>
        <div class="song-field-box">
            <div>
                <button class="song-btn song-btn-primary">原始按钮</button>
                <button class="song-btn">默认按钮</button>
                <button class="song-btn song-btn-normal">百搭按钮</button>
                <button class="song-btn song-btn-warn">暖色按钮</button>
                <button class="song-btn song-btn-danger">警告按钮</button>
                <button class="song-btn song-btn-disabled">禁用按钮</button>
            </div>
            <div style="margin-top: 20px;">
                <button class="song-btn song-btn-lg">大型按钮</button>
                <button class="song-btn">默认按钮</button>
                <button class="song-btn song-btn-sm">小型按钮</button>
                <button class="song-btn song-btn-xs">迷你按钮</button>
            </div>
        </div>
    </fieldset>
    <fieldset class="song-field">
        <legend>表单</legend>
        <div class="song-field-box">
            <div style="margin:15px 0;">块级输入框</div>
            <div class="song-form-item">
                <label for="" class="song-form-label">文本框</label>
                <div class="song-input-block">
                    <input type="text" class="song-input">
                </div>
            </div>
            <div class="song-form-item">
                <label for="" class="song-form-label">密码框</label>
                <div class="song-input-block">
                    <input type="password" class="song-input">
                </div>
            </div>
            <div class="song-form-item">
                <label for="" class="song-form-label">开关</label>
                <div class="song-input-block">
                    <input type="checkbox" name="s1" song-skin="switch" checked>
                    <input type="checkbox" name="s2" song-skin="switch" disabled>
                </div>
            </div>
            <div class="song-form-item">
                <label for="" class="song-form-label">单选</label>
                <div class="song-input-block">
                    <input type="radio" name="r1" title="男" value="男" checked>
                    <input type="radio" name="r1" title="女" value="女">
                    <input type="radio" name="r1" title="第三性别" value="第三性别" disabled>
                </div>
            </div>
            <div class="song-form-item">
                <label for="" class="song-form-label">多选</label>
                <div class="song-input-block">
                    <input type="checkbox" name="c1" title="广州" value="广州" checked>
                    <input type="checkbox" name="c1" title="深圳" value="深圳">
                    <input type="checkbox" name="c1" title="北京" value="北京" disabled>
                </div>
            </div>
            <div class="song-form-item">
                <label for="" class="song-form-label">选择框</label>
                <div class="song-input-block">
                    <select name="city">
                        <option value=""></option>
                        <option value="0">北京</option>
                        <option value="1">上海</option>
                        <option value="2">广州</option>
                        <option value="3">深圳</option>
                        <option value="4">杭州</option>
                    </select>
                </div>
            </div>
            <div class="song-form-item">
                <label for="" class="song-form-label">搜索选择框</label>
                <div class="song-input-block">
                    <select name="city" song-search>
                        <option value=""></option>
                        <option value="0">北京1</option>
                        <option value="1" selected>上海</option>
                        <option value="2">广州</option>
                        <option value="3">深圳</option>
                        <option value="4">杭州</option>
                    </select>
                </div>
            </div>
            <div class="song-form-item">
                <label for="" class="song-form-label">禁用选择框</label>
                <div class="song-input-block">
                    <select name="city" disabled>
                        <option value=""></option>
                        <option value="0">北京2</option>
                        <option value="1">上海</option>
                        <option value="2" selected>广州</option>
                        <option value="3">深圳</option>
                        <option value="4">杭州</option>
                    </select>
                </div>
            </div>
            <div class="song-form-item">
                <label for="" class="song-form-label">文本域</label>
                <div class="song-input-block">
                    <textarea class="song-textarea"></textarea>
                </div>
            </div>
            <div style="margin:15px 0;">行级输入框</div>
            <div class="song-form-item">
                <div class="song-inline">
                    <label for="" class="song-form-label">文本框</label>
                    <div class="song-input-inline">
                        <input type="text" class="song-input">
                    </div>
                </div>
                <div class="song-inline">
                    <label for="" class="song-form-label">密码框</label>
                    <div class="song-input-inline">
                        <input type="password" class="song-input">
                    </div>
                </div>
            </div>
        </div>
    </fieldset>
    <fieldset class="song-field">
        <legend>辅助线</legend>
        <div class="song-field-box">
            <hr>
            <hr class="song-border-light">
            <hr class="song-border-success">
            <hr class="song-border-warn">
            <hr class="song-border-danger">
        </div>
    </fieldset>
    <fieldset class="song-field">
        <legend>默认字段集区块</legend>
        <div class="song-field-box">
            <span>内容区域</span>
        </div>
    </fieldset>
    <fieldset class="song-field song-field-title">
        <legend>标题字段集区块</legend>
        <div class="song-field-box">
            <span>内容区域</span>
        </div>
    </fieldset>
</body>
<script src="jquery-1.12.4.min.js"></script>
<script>
    var form = {
        render: render,
        on: on,
        trigger: trigger,
        getJsonFromForm: getJsonFromForm
    }
    //必须房贷ready里面去执行，ie6-ie8浏览器刷新执行完js后有时会重新选择input刷新前的选中状态
    $(function () {
        form.render();
        form.on('switch', function (event) {
            console.log(event);
        });
        form.on('radio', function (event) {
            console.log(event);
        });
        form.on('checkbox', function (event) {
            console.log(event);
        });
        form.on('select', function (event) {
            console.log(event);
        });
    });
    // 监听事件
    function on(filter, callback) {
        on[filter] = on[filter] || [];
        on[filter].push(callback);
    }
    // 触发事件
    function trigger(filter, event) {
        var arr = on[filter];
        if (arr) {
            for (var i = 0; i < arr.length; i++) {
                arr[i](event);
            }
        }
    }
    // 获取纯数字
    function getNum(str, noParse, dot) {
        if (typeof str == 'number') {
            str = str.toString();
        }
        if (dot === undefined) {
            dot = 2;
        }
        str = (str || '') + '';
        str = str.replace(/\,/g, '');
        str = str.replace(/。/g, '.');
        var reg = new RegExp('\\-?\\d+' + (dot ? '(\\.\\d{0,' + dot + '})?' : ''));
        reg = str.match(reg);
        if (noParse) {
            return reg && reg[0] || (str == '-' ? '-' : '');
        } else {
            return reg && Number(reg[0]) || 0;
        }
    }
    // 获取表单数据
    function getJsonFromForm(fromId) {
        var $form = $(fromId);
        var data = {};
        $form.find('input', function (i, input) {
            var $input = $(input);
            var name = $input.attr('name');
            var value = $input.val();
            if (input.type == 'text' || input.type == 'hidden') {
                name && (data[name] = value);
            } else if (input.type == 'radio' || input.type == 'checkbox') {
                $input.prop('checked') && name && (data[name] = value);
            }
        });
        $form.find('select', function (i, select) {
            var $select = $(select);
            var name = $select.attr('name');
            var value = $select.val();
            name && (data[name] = value);
        });
        $form.find('textarea', function (i, textarea) {
            var $textarea = $(textarea);
            var name = $textarea.attr('name');
            var value = $textarea.val();
            name && (data[name] = value);
        });
    }
    // 渲染页面ui
    function render(tagName) {
        tagName = tagName && tagName.toLowerCase() || '';
        switch (tagName) {
            case 'switch': renderSwitch(true); break;
            case 'radiao': renderRadio(true); break;
            case 'checkbox': renderCheckbox(true); break;
            case 'select': renderSelect(true); break;
            default:
                renderSwitch(true);
                renderRadio(true);
                renderCheckbox(true);
                renderSelect(true);
        }
    }
    //渲染开关
    function renderSwitch(fresh) {
        var inputs = $('input[type="checkbox"][song-skin="switch"]');
        inputs.each(function (i, input) {
            if (input.renderedSongUi && !fresh) {
                return;
            }
            var $input = $(input);
            var ignore = $input.attr('song-ignore') === undefined ? false : true;
            var classNames = '';
            input.$ui && input.$ui.remove();
            if (ignore) {
                return;
            }
            if ($input.prop('disabled')) {
                classNames += ' song-switch-disabled';
            }
            if ($input.prop('checked')) {
                classNames += ' song-switch-checked';
            }
            var $html = $(
                '<div class="song-form-switch ' + classNames + '">\
                    <i></i>\
                    <span>'+ ($input.prop('checked') ? 'ON' : 'OFF') + '</span>\
                </div>');
            $html.insertAfter(input);
            $html[0].$input = $input;
            $input.$ui = $html;
            _bindEvent($html);
            $input.hide();
            input.renderedSongUi = true;
        });
        function _bindEvent($dom) {
            $dom.on('click', function () {
                var $this = $(this);
                var filter = this.$input.attr('song-filter');
                if ($this.hasClass('song-switch-disabled')) {
                    return;
                }
                $this.toggleClass('song-switch-checked');
                if ($this.hasClass('song-switch-checked')) {
                    $this.find('span').html('ON');
                    $this[0].$input.prop('checked', true);
                } else {
                    $this.find('span').html('OFF');
                    $this[0].$input.prop('checked', false);
                }
                form.trigger(filter ? 'switch(' + filter + ')' : 'switch', {
                    data: $this[0].$input.prop('checked'),
                    dom: $this[0].$input[0]
                });
            });
        }
    }
    // 渲染单选按钮
    function renderRadio(fresh) {
        var inputs = $('input[type="radio"]');
        inputs.each(function (i, input) {
            if (input.renderedSongUi && !fresh) {
                return false;
            }
            var $input = $(input);
            var ignore = $input.attr('song-ignore') === undefined ? false : true;
            var classNames = '';
            input.$ui && input.$ui.remove();
            if (ignore) {
                return;
            }
            if ($input.prop('disabled')) {
                classNames += ' song-radio-disabled';
            }
            if ($input.prop('checked')) {
                classNames += ' song-radio-checked';
            }
            var html =
                '<div class="song-form-radio ' + classNames + '">\
                    <i>'+ ($input.prop('checked') ? '&#xe61c;' : '&#xe619;') + '</i>\
                    <span>'+ $input.attr('title') + '</span>\
                </div>';
            var $html = $(html);
            $html.insertAfter(input);
            $html[0].$input = $input;
            $input.$ui = $html;
            _bindEvent($html);
            $input.hide();
            input.renderedSongUi = true;
        });
        //绑定事件
        function _bindEvent($dom) {
            $dom.on('click', function () {
                var $this = $(this);
                var filter = this.$input.attr('song-filter');
                if ($this.hasClass('song-radio-disabled')) {
                    return;
                }
                $('.song-form-radio').each(function (i, radio) {
                    var $_this = $(this);
                    if ($_this[0].$input.attr('name') == $this[0].$input.attr('name')) {
                        $_this.removeClass('song-radio-checked').find('i').html('&#xe619;');
                    }
                });
                $this.addClass('song-radio-checked');
                $this.find('i').html('&#xe61c;');
                $this[0].$input.prop('checked', true);
                form.trigger(filter ? 'radio(' + filter + ')' : 'radio', {
                    data: $this[0].$input.val(),
                    dom: $this[0].$input[0]
                });
            });
        }
    }
    // 渲染复选框
    function renderCheckbox(fresh) {
        var inputs = $('input[type="checkbox"]');
        inputs.each(function (i, input) {
            if (input.renderedSongUi && !fresh) {
                return;
            }
            var $input = $(input);
            var ignore = $input.attr('song-ignore') === undefined ? false : true;
            input.$ui && input.$ui.remove();
            if (ignore) {
                return;
            }
            if ($input.attr('song-skin') == 'switch') {
                return;
            }
            var classNames = '';
            if ($input.prop('disabled')) {
                classNames += ' song-checkbox-disabled';
            }
            if ($input.prop('checked')) {
                classNames += ' song-checkbox-checked';
            }
            var $html = $(
                '<div class="song-form-checkbox ' + classNames + '">\
                    <i>'+ ($input.prop('checked') ? '&#xe609;' : '') + '</i>\
                    <span>'+ $input.attr('title') + '</span>\
                </div>');

            $html.insertAfter(input);
            $html[0].$input = $input;
            $input.$ui = $html;
            _bindEvent($html);
            $input.hide();
            input.renderedSongUi = true;
        });

        function _bindEvent($dom) {
            $dom.on('click', function () {
                var $this = $(this);
                var filter = this.$input.attr('song-filter');
                var data = [];
                if ($this.hasClass('song-checkbox-disabled')) {
                    return;
                }
                $this.toggleClass('song-checkbox-checked');
                if ($this.hasClass('song-checkbox-checked')) {
                    $this.find('i').html('&#xe609;');
                    $this[0].$input.prop('checked', true);
                } else {
                    $this.find('i').html('');
                    $this[0].$input.prop('checked', false);
                }
                $('.song-checkbox-checked').each(function (i, radio) {
                    var $_this = $(this);
                    if ($_this[0].$input.attr('name') == $this[0].$input.attr('name')) {
                        data.push($_this[0].$input.val());
                    }
                });
                form.trigger(filter ? 'checkbox(' + filter + ')' : 'checkbox', {
                    data: data,
                    dom: $this[0].$input[0]
                });
            });
        }
    }
    // 渲染下拉选择框
    function renderSelect(fresh) {
        $('select').each(function (i, select) {
            if (select.renderedSongUi && !fresh) {
                return;
            }
            var $select = $(select);
            var ignore = $select.attr('song-ignore') === undefined ? false : true;
            var search = $select.attr('song-search') === undefined ? false : true;
            var classNames = '';
            select.$ui && select.$ui.remove();
            if (ignore) {
                return;
            }
            if ($select.prop('disabled')) {
                classNames += ' song-select-disabled';
            }
            var $html = $(
                '<div class="song-form-select ' + classNames + '">\
                    <div class="song-select-title">\
                        <input type="text" class="song-input" placeholder="请选择" '+ (search ? '' : 'readonly') + '>\
                        <i>&#xe69b;</i>\
                    </div>\
                </div>');
            var html = '<dl class="song-select-dl">';
            var $input = $html.find('input');
            $select.find('option').each(function (i, opt) {
                var $opt = $(opt);
                var text = $opt.text();
                var value = $opt.val();
                var classNames = '';
                if (!text) {
                    classNames += ' song-color-holder';
                }
                if ($select.val() == value) {
                    $input.attr('data-value', $select.val());
                    $input.val(text);
                    classNames += ' song-select-active';
                }
                html += '<dd class="' + classNames + '" data-value="' + value + '">' + (text || '请选择') + '</dd>';
            });
            html += '</dl>';
            $html.append(html);
            $html.insertAfter($select);
            $html[0].$select = $select;
            select.$ui = $html;
            _bindEvent($html);
            $select.hide();
            select.renderedSongUi = true;
        });
        // 绑定事件
        function _bindEvent($dom) {
            var search = $dom[0].$select.attr('song-search') === undefined ? false : true;
            var $title = $dom.find('.song-select-title');
            var $cont = $dom.find('.song-select-dl');
            var $input = $dom.find('.song-input');
            $title.on('click', function () {
                if ($dom.hasClass('song-select-disabled')) {
                    return;
                }
                if ($cont.is(':visible')) {
                    $title.trigger('blur');
                } else {
                    // 其他选择框都收起
                    $('.song-select-dl').hide().parents('.song-form-item').css({ 'z-index': '1' });
                    $title.parents('.song-form-item').css({ 'z-index': '99' });
                    $cont.find('dd').show();
                    $cont.show();
                }
                return false;
            });
            $title.on('blur', function () {
                var $dd = $cont.find('.song-select-active');
                $input.val($dd.attr('data-value') && $dd.text() || '');
                $cont.hide();
                setTimeout(function () {
                    $input.blur()
                }, 50);
            });
            $cont.find('dd').on('click', function () {
                var $this = $(this);
                var value = $this.attr('data-value');
                var filter = $dom[0].$select.attr('song-filter') || '';
                $cont.find('.song-select-active').removeClass('song-select-active');
                $this.addClass('song-select-active');
                $input.val(value && $this.text() || '').attr('data-value', $this.attr('data-value'));
                $dom[0].$select.val(value);
                $cont.hide();
                form.trigger(filter ? 'select(' + filter + ')' : 'select', {
                    data: value,
                    dom: $dom[0].$select[0]
                });
            });
            // 可搜索
            if (search) {
                $input.on('input propertychange', function () {
                    var title = $(this).val();
                    $cont.find('dd').each(function (i, dd) {
                        var $dd = $(dd);
                        if ($dd.text().indexOf(title) == -1) {
                            $dd.hide();
                        } else {
                            $dd.show();
                        }
                    });
                });
            }
            // 点击页面收起下拉框
            if (!renderSelect.bindedBodyEvent) {
                $(document.body).on('click', function (e) {
                    $('.song-form-select:visible').find('.song-select-title').trigger('blur');
                });
                renderSelect.bindedBodyEvent = true;
            }
        }
    }

</script>

</html>